{
    "_comment": "FRC Ball er - Tunable Configuration. Edit directly or use 01_hsv_tuning.py to tune interactively.",
    "video": {
        "default_path": "kettering_final_2.mkv",
        "playback_speed": 1.0
    },
    "roi": {
        "x": 6,
        "y": 70,
        "w": 1914,
        "h": 760
    },
    "hsv_yellow": {
        "_comment": "HSV range for yellow ball detection. TUNE THIS ON GAME DAY.",
        "h_low": 23,
        "h_high": 40,
        "s_low": 132,
        "s_high": 255,
        "v_low": 133,
        "v_high": 255
    },
    "morphology": {
        "_comment": "Morphological operations to clean up the mask.",
        "open_kernel": 3,
        "close_kernel": 7,
        "dilate_kernel": 3,
        "dilate_iterations": 1
    },
    "contour_filter": {
        "_comment": "Contour filtering for ball candidates.",
        "min_area": 43,
        "max_area": 194,
        "min_circularity": 0.35,
        "min_aspect_ratio": 0.5,
        "max_aspect_ratio": 2.0
    },
    "watershed": {
        "_comment": "DEPRECATED: Use cluster_splitting instead. Kept for fallback.",
        "enabled": false,
        "peak_ratio": 0.45,
        "min_peak_distance": 8,
        "area_multiplier": 1.8
    },
    "cluster_splitting": {
        "_comment": "NMS-based cluster splitting for touching/overlapping balls. Preferred over watershed.",
        "enabled": false,
        "method": "nms",
        "min_ball_radius": 5,
        "peak_threshold": 0.56,
        "area_multiplier": 1.47,
        "max_cluster_area": 5000
    },
    "gpu": {
        "_comment": "GPU acceleration via CuPy. Install: pip install cupy-cuda12x",
        "enabled": true
    },
    "tracking": {
        "_comment": "Legacy centroid tracker parameters. Used when ball_tracking.tracker = 'centroid'.",
        "max_distance": 80,
        "max_frames_missing": 8,
        "trail_length": 30
    },
    "ball_tracking": {
        "_comment": "OC-SORT ball tracker with Kalman filter. Set tracker to 'kalman' or 'centroid' (legacy).",
        "tracker": "kalman",
        "max_distance": 120,
        "max_age": 15,
        "min_hits": 3,
        "trail_length": 30,
        "base_gate_radius": 30,
        "gate_factor": 2.5,
        "match_threshold": 0.8,
        "cost_weights": {
            "w_predicted_dist": 0.5,
            "w_velocity": 0.3,
            "w_size": 0.2
        },
        "enable_reidentification": true,
        "dead_track_max_age": 30,
        "goal_proximity_extension": 2.0,
        "use_oru": true,
        "use_ocm": true,
        "process_noise_position": 1.0,
        "process_noise_velocity": 5.0,
        "measurement_noise": 2.0
    },
    "motion": {
        "_comment": "Optional motion filtering to separate moving vs stationary balls.",
        "use_motion_filter": false,
        "bg_subtractor_history": 300,
        "bg_subtractor_threshold": 50,
        "min_motion_area": 30
    },
    "goal_regions": {
        "_comment": "Define scoring zones. Supports rectangles {name, x, y, w, h} or polygons {name, polygon: [[x,y],...]}. Use 'g' for rect, 'G' for polygon in 04_zones.py.",
        "regions": [
            {
                "name": "RED_HUB",
                "polygon": [
                    [
                        1328,
                        269
                    ],
                    [
                        1376,
                        293
                    ],
                    [
                        1351,
                        321
                    ],
                    [
                        1277,
                        320
                    ],
                    [
                        1233,
                        293
                    ],
                    [
                        1264,
                        268
                    ]
                ]
            },
            {
                "name": "BLUE_HUB",
                "polygon": [
                    [
                        365,
                        323
                    ],
                    [
                        345,
                        294
                    ],
                    [
                        396,
                        272
                    ],
                    [
                        465,
                        273
                    ],
                    [
                        488,
                        297
                    ],
                    [
                        448,
                        323
                    ]
                ]
            }
        ]
    },
    "robot_zones": {
        "_comment": "Robot identification zones or labels. Set via 04_zones.py.",
        "robots": []
    },
    "shot_detection": {
        "_comment": "Parameters for identifying shots (balls in upward/arcing flight).",
        "min_upward_velocity": -3.0,
        "min_downward_velocity": 2.0,
        "require_bbox_exit": true,
        "min_speed": 5.0,
        "min_shot_speed": 8.0,
        "proximity_to_robot": 120,
        "min_flight_frames": 4,
        "goal_proximity_x": 150,
        "goal_proximity_y": 100,
        "classify_field_passes": false,
        "trajectory_fit_window": 8,
        "min_trajectory_r_squared": 0.85,
        "enable_launch_extrapolation": true,
        "enable_goal_prediction": true
    },
    "human_player_zones": {
        "_comment": "Define human player zones for shot attribution. Supports polygons and rectangles.",
        "enabled": true,
        "zones": [
            {
                "name": "qs",
                "x": 1522,
                "y": 40,
                "w": 389,
                "h": 261
            }
        ]
    },
    "robot_tracking": {
        "_comment": "OC-SORT tracker for robust robot tracking. Set tracker to 'ocsort' or 'centroid'.",
        "tracker": "ocsort",
        "max_age": 15,
        "min_hits": 3,
        "iou_threshold": 0.3,
        "use_oru": true,
        "use_ocm": true,
        "dead_track_max_age": 90,
        "enable_reidentification": true,
        "alliance_counts": {
            "red": 3,
            "blue": 3
        }
    },
    "robot_detection": {
        "_comment": "Dynamic robot tracking by bumper color. Use 06_robot_tuning.py to tune HSV values.",
        "enabled": false,
        "track_alliance": "both",
        "hsv_red": {
            "_comment": "Red HSV range (wraps around 0/180, so uses two ranges)",
            "h_low1": 0,
            "h_high1": 12,
            "h_low2": 145,
            "h_high2": 180,
            "s_low": 75,
            "s_high": 255,
            "v_low": 78,
            "v_high": 143
        },
        "hsv_blue": {
            "h_low": 101,
            "h_high": 164,
            "s_low": 111,
            "s_high": 255,
            "v_low": 80,
            "v_high": 255
        },
        "min_bumper_area": 453,
        "max_bumper_area": 1852,
        "min_aspect_ratio": 0.8,
        "max_aspect_ratio": 7.9,
        "ocr_enabled": false,
        "tracking": {
            "max_distance": 150,
            "max_frames_missing": 15
        }
    },
    "yolo_robot_detection": {
        "_comment": "YOLO-based robot detection using custom trained model. Use 08_train_bumper_model.py to train.",
        "enabled": true,
        "model_path": "models/bumper_detector.pt",
        "confidence_threshold": 0.5,
        "bbox_expansion_factor": 2.0,
        "use_tracker": "ocsort"
    },
    "yolo_ball_detection": {
        "_comment": "YOLO-based ball detection for real-time pipeline. Use 09_train_ball_model.py to train.",
        "enabled": false,
        "model_path": "models/ball_detector.pt",
        "confidence_threshold": 0.3
    },
    "input": {
        "_comment": "Input source settings for live camera or RTSP streams.",
        "source": null,
        "camera_fps_override": null,
        "drop_frames_if_behind": true
    },
    "output": {
        "annotated_video_path": "output_annotated.mp4",
        "csv_path": "shot_log.csv",
        "codec": "mp4v",
        "use_nvenc": true,
        "nvenc_preset": "p4",
        "nvenc_cq": 23,
        "draw_trails": true,
        "draw_ids": true,
        "tracer_mode": "shots_only",
        "trail_color_scored": [
            0,
            255,
            0
        ],
        "trail_color_missed": [
            0,
            0,
            255
        ],
        "trail_color_unknown": [
            0,
            255,
            255
        ],
        "trail_color_field_pass": [
            255,
            255,
            0
        ]
    }
}